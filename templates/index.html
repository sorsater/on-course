{% extends "base.html" %}
{% block body %}
    <div id="container">
    </div>

<!-- scripts -->

<script type="text/jsx">
/** @jsx React.DOM */

// begin teset
class ProductCategoryRow extends React.Component {
  render() {
    return (<tr><th colSpan="2">{this.props.category}</th></tr>);
  }
}

class ProductRow extends React.Component {
  render() {
    var name = this.props.product.name;
    return (
      <tr>
        <td>{this.props.product.price}</td>
        <td>{name}</td>
        <td>{this.props.product.category}</td>
      </tr>
    );
  }
}

class ProductTable extends React.Component {
  render() {
    var rows = [];
    var lastCategory = null;
    this.props.products.forEach((product) => {
      rows.push(<ProductRow product={product} key={product.name} />);
    });
    var tableStyle = {width: '100%'};
    var tTdStyle = {width: '40%'};
    var normalTdStyle = {width: '8%'};

    return (
      <table style={tableStyle}>
        <thead>
          <tr>
            <th style={normalTdStyle}> </th>
            <th style={tTdStyle}>HT1</th>
            <th style={tTdStyle}>HT2</th>
          </tr>
        </thead>
        <tbody>{rows}</tbody>
      </table>
    );
  }
}


class FilterableProductTable extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      filterText: '',
      inStockOnly: false
    };

    this.handleFilterTextInput = this.handleFilterTextInput.bind(this);
  }

  handleFilterTextInput(filterText) {
    this.setState({
      filterText: filterText
    });
  }

  render() {
    return (
      <div>
        <ProductTable
          products={this.props.products}
          filterText={this.state.filterText}
        />
      </div>
    );
  }
}

var PRODUCTS = [
  {category: 'Sporting Goods', price: '1', stocked: true, name: 'Football'},
  {category: 'Sporting Goods', price: '1', stocked: true, name: 'Baseball'},
  {category: 'Sporting Goods', price: '2', stocked: false, name: 'Basketball'},
  {category: 'Electronics', price: '3', stocked: true, name: 'iPod Touch'},
  {category: 'Electronics', price: '3', stocked: false, name: 'iPhone 5'},
  {category: 'Electronics', price: '4', stocked: true, name: 'Nexus 7'}
];

//ReactDOM.render(
//  <FilterableProductTable products={PRODUCTS} />,
//  document.getElementById('coursedSchedule')
//);
// end test

function courseClick(course){
    console.log("Course clicked: " + course.code);
    console.log(course);
    shoppingCart.push(course);
    console.log(shoppingCart);
    var pos = document.getElementById('ht1b1');
    pos.innerHTML += course.code;
};

class CourseRow extends React.Component{
  addCourse() {
   this.props.onClick(this.props.course.code);
  }
  render() {
    var nameTdStyle = {width: '70%', color: 'white'};
    var normalTdStyle = {width: '8%', color: 'white'};

    return (
      <div className="row row-eq-height course-row" onClick={this.addCourse.bind(this)}>
        <div className="col-sm-2 course-row">
          <a href="#">{this.props.course.code}</a>
        </div>
        <div className="col-sm-1 course-row">
          {this.props.course.hp}
        </div>
        <div className="col-sm-1 course-row">
          {this.props.course.level}
        </div>
        <div className="col-sm-8 course-row">
          {this.props.course.name}
        </div>
      </div>
    )
  }
}

class ProfileRow extends React.Component{
  profileCheckbox() {
    this.props.onClick(this.props.profile.id);
  }
  render() {
    return (
      <div className="col-sm-3 profile-color profileElement" onClick={this.profileCheckbox.bind(this)}>
        <input type="checkbox" name={this.props.profile.id} />{this.props.profile.name}
      </div>
    )
  }
}

class CourseViewer extends React.Component{
  constructor(props){
    super(props);
    this.handleChange = this.handleChange.bind(this);
    this.addCourse = this.addCourse.bind(this);
    this.state = {searchString: '', courseList: []};
  }

  // sets state, triggers render method
  handleChange(event){
    // grab value form input box
    this.setState({searchString:event.target.value});
  }

  // Adding course to the list
  addCourse(code) {
    console.log('clicking course', code);
    this.state.courseList.push(code);
    console.log(this.state.courseList);
  }



  render() {
    var courses = this.props.courses;
    var searchString = this.state.searchString.trim().toLowerCase();

    // filter courses list by value from input box
    if(searchString.length > 0){
      courses = courses.filter(function(course){
        return (course.code + course.name).toLowerCase().match( searchString );
      });
    }
    var courseRows = []
    courses.forEach((course) => {
      courseRows.push(<CourseRow key={course.code} course={course} handler={this.addCourse} onClick={this.addCourse.bind(this)}/>);
    })

    var tableStyle = {width: '100%'};
    var divStyle = {padding: '20px'};

    return (
      <div style={divStyle}>
        <input id="search" type="text"
              value={this.state.searchString}
              onChange={this.handleChange}
              placeholder="Vad fÃ¥r det lov att vara? ðŸ˜‹"
        />

        {courseRows}

      </div>
    )
  }
};

class ProfileSelector extends React.Component{
  profileCheckbox(id) {
    console.log('profile checkbox click')
    console.log(id);

    var profile_match = this.props.profiles.filter(function(profile) {
      return (profile.id == id);
    });
    console.log(JSON.stringify(profile_match));
  }

  render() {
    var profileRows = [];
    var profiles = this.props.profiles

    profiles.forEach((profile) => {
      profileRows.push(<ProfileRow key={profile.id} profile={profile} onClick={this.profileCheckbox.bind(this)}/>);
    });
    var s = {padding: '15px'};
    return (
      <div style={s}>
        <div className="row white">
          {profileRows}
        </div>
      </div>
    )
  }

};

class MainPage extends React.Component{
  constructor(props) {
    super(props);
  }

  render() {
    var tableStyleLeft = {width: '70%'}
    var tableStyleRight = {width: '30%'};

    return (
      <div className="row row-eq-height container-fluid potatis">
        <div className="col-sm-8 grey">
          <ProfileSelector
            profiles={this.props.profiles}
          />
          <CourseViewer
            courses={this.props.courses}
          />
        </div>
        <div className="col-sm-4 gray">
            <div className="row">
              <div className="col-sm-3 gray noborder">
                Block
              </div>
              <div className="col-sm-3 gray noborder">
                HT1
              </div>
              <div className="col-sm-3 gray noborder">
                HT2
              </div>
            </div>
            <div className="row">
              <div className="col-sm-3 gray noborder">
                1
              </div>
              <div className="col-sm-3 gray noborder">
                TDDD27
              </div>
              <div className="col-sm-3 gray noborder">
                TDDE01
              </div>
            </div>
            <div className="row">
              <div className="col-sm-3 gray noborder">
                2
              </div>
              <div className="col-sm-3 gray noborder">
                TATA24
              </div>
              <div className="col-sm-3 gray noborder">
                TDDD83
              </div>
            </div>
            <div className="row">
              <div className="col-sm-3 gray noborder">
                3
              </div>
              <div className="col-sm-3 gray noborder">
                TAEN33
              </div>
              <div className="col-sm-3 gray noborder">

              </div>
            </div>
            <div className="row">
              <div className="col-sm-3 gray noborder">
                4
              </div>
              <div className="col-sm-3 gray noborder">

              </div>
              <div className="col-sm-3 gray noborder">
                TAMS27
              </div>
            </div>
        </div>
      </div>
    )
  }
}

// list of courses, defined with JavaScript object literals
var courses = [
  {% for course in courses %}
    {
      "code": "{{ course.code }}",
      "hp": "{{ course.hp }}",
      "level": "{{ course.level }}",
      "name": "{{ course.name }}"
    },
  {% endfor %}
];

var profiles = [
  {% for prof in profiles %}
    {
      "id": "{{ prof.ID }}",
      "name": "{{ prof.name }}",
      "fieldID": "{{ prof.fieldID }}",
      "link": "{{ prof.link }}",
    },
  {% endfor %}
];

var schedule = [
  {% for sc in schedule %}
    {
      "id": "{{ sc.ID }}",
      "code": "{{ sc.code }}",
      "period": "{{ sc.period }}",
      "block1": "{{ sc.block1 }}",
      "block2": "{{ sc.block2 }}",
    },
  {% endfor %}
];

var courseProfiles = [
  {% for cp in course_profiles %}
    {
      "id": "{{ cp.ID }}",
      "code": "{{ cp.code }}",
      "profileID": "{{ cp.profileID }}",
      "vof": "{{ cp.vof }}",
    },
  {% endfor %}
];

ReactDOM.render(
  <MainPage courses={ courses } profiles={profiles}/>,
  document.getElementById('container')
);
</script>

{% endblock %}
